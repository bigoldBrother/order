<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FreightDao.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">freightservice</a> &gt; <a href="index.source.html" class="el_package">cn.edu.xmu.freight.dao</a> &gt; <span class="el_source">FreightDao.java</span></div><h1>FreightDao.java</h1><pre class="source lang-java linenums">package cn.edu.xmu.freight.dao;

import cn.edu.xmu.freight.mapper.FreightModelPoMapper;
import cn.edu.xmu.freight.mapper.PieceFreightModelPoMapper;
import cn.edu.xmu.freight.mapper.WeightFreightModelPoMapper;
import cn.edu.xmu.freight.model.bo.*;
import cn.edu.xmu.freight.model.po.*;
import cn.edu.xmu.freight.model.vo.*;
import cn.edu.xmu.ooad.model.VoObject;
import cn.edu.xmu.ooad.util.ResponseCode;
import cn.edu.xmu.ooad.util.ReturnObject;
import com.github.pagehelper.PageHelper;
import com.github.pagehelper.PageInfo;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.DataAccessException;
import org.springframework.stereotype.Repository;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

/**
 * @author issyu 30320182200070
 * @date 2020/12/5 1:24
 */
@Repository
<span class="fc" id="L28">public class FreightDao {</span>

    @Autowired
    private FreightModelPoMapper freightModelPoMapper;
    @Autowired
    private WeightFreightModelPoMapper weightFreightModelPoMapper;
    @Autowired
    private PieceFreightModelPoMapper pieceFreightModelPoMapper;

    /**
     * 获取店铺中商品的运费模板
     * @author issyu 30320182200070
     * @date 2020/12/5 14:58
     */
    public ReturnObject getFreghtModelsInShop(FreightModelVo freightModelVo, Integer page, Integer pageSize){

<span class="nc" id="L44">        FreightModelPoExample freightModelPoExample = new FreightModelPoExample();</span>
<span class="nc" id="L45">        FreightModelPoExample.Criteria criteria = freightModelPoExample.createCriteria();</span>

<span class="nc" id="L47">        criteria.andShopIdEqualTo(freightModelVo.getShopId());</span>

<span class="nc bnc" id="L49" title="All 2 branches missed.">        if(freightModelVo.getName()!=null)</span>
        {
<span class="nc" id="L51">            criteria.andNameEqualTo(freightModelVo.getName());</span>
        }

        try{
<span class="nc" id="L55">            PageHelper.startPage(page,pageSize);</span>

<span class="nc" id="L57">            List&lt;FreightModelPo&gt; freightModelPos = freightModelPoMapper.selectByExample(freightModelPoExample);</span>

<span class="nc" id="L59">            PageInfo&lt;FreightModelPo&gt; pages = new PageInfo&lt;&gt;(freightModelPos);</span>

<span class="nc" id="L61">            List&lt;VoObject&gt; operationOrders = pages.getList()</span>
<span class="nc" id="L62">                    .stream()</span>
<span class="nc" id="L63">                    .map(FreightModelBo::new)</span>
                    //this Bo implements VoObject
<span class="nc" id="L65">                    .collect(Collectors.toList());</span>

<span class="nc" id="L67">            PageInfo&lt;VoObject&gt; returnObject = new PageInfo&lt;&gt;(operationOrders);</span>
<span class="nc" id="L68">            returnObject.setPages(pages.getPages());</span>
<span class="nc" id="L69">            returnObject.setPageNum(pages.getPageNum());</span>
<span class="nc" id="L70">            returnObject.setPageSize(pages.getPageSize());</span>
<span class="nc" id="L71">            returnObject.setTotal(pages.getTotal());</span>

<span class="nc" id="L73">            return new ReturnObject&lt;&gt;(returnObject);</span>

<span class="nc" id="L75">        }catch (DataAccessException e){</span>
<span class="nc" id="L76">            return  new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误：&quot;+ e.getMessage()));</span>
        }
    }

    /**
     * 定义店铺中商品的运费模板
     * @author issyu 30320182200070
     * @date 2020/12/8 1:33
     */
    public ReturnObject&lt;VoObject&gt; defineFreightModel(FreightModelVo freightModelVo,Long id,Long departId){

<span class="nc" id="L87">        FreightModelPo freightModelPo = freightModelVo.createFreightModePo(Boolean.TRUE,id);</span>

        try{
<span class="nc" id="L90">            int ret = freightModelPoMapper.insertSelective(freightModelPo);</span>
<span class="nc" id="L91">            FreightModelBo freightModelBo  = new FreightModelBo(freightModelPo);</span>

<span class="nc bnc" id="L93" title="All 2 branches missed.">            if(ret == 0){</span>
<span class="nc" id="L94">                return  new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误&quot;));</span>
            }else{
<span class="nc" id="L96">                return new ReturnObject&lt;&gt;(freightModelBo);</span>
            }

<span class="nc" id="L99">        }catch (DataAccessException e){</span>
<span class="nc" id="L100">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库内部错误：&quot;+e.getMessage()));</span>
        }

    }
    /**
     * 店家或管理员为店铺定义默认运费模板
     * @author 王薪蕾
     * @date 2020/12/7
     */

    public ReturnObject&lt;Object&gt; postFreightModelToShop(Long userId,Long shopId,Long id){

<span class="nc" id="L112">        FreightModelPo freightModelPo = freightModelPoMapper.selectByPrimaryKey(id);</span>
<span class="nc" id="L113">        ReturnObject&lt;Object&gt; retObj = null;</span>
        //资源不存在
<span class="nc bnc" id="L115" title="All 2 branches missed.">        if (freightModelPo == null) {</span>
<span class="nc" id="L116">            retObj = new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;运费模板不存在：id=&quot; + id));</span>
<span class="nc" id="L117">            return retObj;</span>
        }
        //不是本店铺模板
<span class="nc bnc" id="L120" title="All 2 branches missed.">        if (freightModelPo.getShopId()!=shopId) {</span>
<span class="nc" id="L121">            retObj = new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_OUTSCOPE, String.format(&quot;运费模板不是本店铺的对象：运费模板id=&quot; + id));</span>
<span class="nc" id="L122">            return retObj;</span>
        }
        //用户无权限，暂无
        //设为默认
<span class="nc" id="L126">        freightModelPo.setDefaultModel((byte)1);</span>
        try {
<span class="nc" id="L128">            int ret = freightModelPoMapper.updateByPrimaryKey(freightModelPo);</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">            if (ret == 0) {</span>
                //设置失败
<span class="nc" id="L131">                retObj = new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;数据库更新不成功&quot;));</span>
            } else {
                //设置成功
<span class="nc" id="L134">                retObj = new ReturnObject&lt;&gt;(ResponseCode.OK,String.format(&quot;成功&quot;));</span>
            }
<span class="nc" id="L136">        } catch (DataAccessException e) {</span>
<span class="nc" id="L137">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;数据库错误：%s&quot;, e.getMessage()));</span>
<span class="nc" id="L138">        } catch (Exception e) {</span>
            // 其他Exception错误
<span class="nc" id="L140">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;发生了未知错误：%s&quot;, e.getMessage()));</span>
<span class="nc" id="L141">        }</span>
<span class="nc" id="L142">        return retObj;</span>
    }
    /**
     * 管理员定义重量模板明细
     * @author 王薪蕾
     * @date 2020/12/9
     */
    public ReturnObject&lt;Object&gt; postWeightItems(WeightModelInfoVo vo, Long shopId, Long id){

<span class="nc" id="L151">        ReturnObject&lt;Object&gt; retObj = null;</span>
        try {
<span class="nc" id="L153">            WeightModelInfoBo weightModelInfoBo=vo.createWeightModelInfoBo();</span>
<span class="nc" id="L154">            weightModelInfoBo.setFreightModelId(id);</span>
<span class="nc" id="L155">            weightModelInfoBo.setGmtCreate(LocalDateTime.now());</span>
<span class="nc" id="L156">            weightModelInfoBo.setGmtModified(LocalDateTime.now());</span>

            //获得运费模板
<span class="nc" id="L159">            FreightModelPo freightModelPo=freightModelPoMapper.selectByPrimaryKey(id);</span>
            //运费模板不存在
<span class="nc bnc" id="L161" title="All 2 branches missed.">            if(freightModelPo==null){</span>
<span class="nc" id="L162">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;运费模板不存在&quot;));</span>
            }
            //运费模板不是本店铺的
<span class="nc bnc" id="L165" title="All 2 branches missed.">            if(freightModelPo.getShopId()!=shopId){</span>
<span class="nc" id="L166">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_OUTSCOPE, String.format(&quot;运费模板不是本店铺的对象：运费模板id=&quot; + freightModelPo.getId()));</span>
            }
            //运费模板模式不是重量运费模板
<span class="nc bnc" id="L169" title="All 2 branches missed.">            if(freightModelPo.getType()!=(byte)0){</span>
<span class="nc" id="L170">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;运费模板模式不是重量运费模板&quot;));</span>
            }
            //获得数据库中此运费模板的所有明细
<span class="nc" id="L173">            WeightFreightModelPoExample weightFreightModelPoExample=new WeightFreightModelPoExample();</span>
<span class="nc" id="L174">            WeightFreightModelPoExample.Criteria criteria=weightFreightModelPoExample.createCriteria();</span>
<span class="nc" id="L175">            criteria.andFreightModelIdEqualTo(id);</span>
<span class="nc" id="L176">            List&lt;WeightFreightModelPo&gt; weightFreightPos = weightFreightModelPoMapper.selectByExample(weightFreightModelPoExample);</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">            if (!weightFreightPos.isEmpty())</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">                for (WeightFreightModelPo po : weightFreightPos) {</span>
                    //如果找到一样的地区定义，则返回错误
<span class="nc bnc" id="L180" title="All 2 branches missed.">                    if (po.getRegionId().equals(weightModelInfoBo.getRegionId())) {</span>
<span class="nc" id="L181">                        return new ReturnObject&lt;&gt;(ResponseCode.REGION_SAME, String.format(&quot;运费模板中该地区已定义&quot;));</span>
                    }
<span class="nc" id="L183">                }</span>
            //表中插入明细数据
<span class="nc" id="L185">            WeightFreightModelPo weightFreightModelPo=weightModelInfoBo.getweightFreightModelPo();</span>
<span class="nc" id="L186">            int retweightFreightModel = weightFreightModelPoMapper.insertSelective(weightFreightModelPo);</span>
<span class="nc" id="L187">            WeightModelInfoRetVo weightModelInfoRetVo=new WeightModelInfoRetVo(weightModelInfoBo);</span>
<span class="nc" id="L188">            weightModelInfoRetVo.setId(weightFreightModelPo.getId());</span>
            //更新运费模板时间
<span class="nc" id="L190">            freightModelPo.setGmtModified(LocalDateTime.now());</span>
<span class="nc" id="L191">            freightModelPoMapper.updateByPrimaryKey(freightModelPo);</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">            if (retweightFreightModel == 0) {</span>
<span class="nc" id="L193">                retObj = new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;数据库错误：新增失败&quot;));</span>
            }
            else {
<span class="nc" id="L196">                retObj = new ReturnObject&lt;&gt;(weightModelInfoRetVo);</span>
            }
<span class="nc" id="L198">        }catch (DataAccessException e){</span>
<span class="nc" id="L199">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误&quot;));</span>
<span class="nc" id="L200">        }catch (Exception e){</span>
<span class="nc" id="L201">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;发生了未知错误：%s&quot;, e.getMessage()));</span>
<span class="nc" id="L202">        }</span>
<span class="nc" id="L203">        return retObj;</span>
    }

    /**
     * 管理员删除运费模板
     * @author 王薪蕾
     * @date 2020/12/9
     */
    public ReturnObject deleteFreightModel(Long shopId, Long id) {
        try{
<span class="nc" id="L213">            FreightModelPo freightModelPo=freightModelPoMapper.selectByPrimaryKey(id);</span>
            //运费模板不存在
<span class="nc bnc" id="L215" title="All 2 branches missed.">            if(freightModelPo==null){</span>
<span class="nc" id="L216">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;运费模板不存在&quot;));</span>
            }
            //运费模板不是本店铺的
<span class="nc bnc" id="L219" title="All 2 branches missed.">            if(freightModelPo.getId()!=shopId){</span>
<span class="nc" id="L220">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_OUTSCOPE, String.format(&quot;运费模板不是本店铺的对象：运费模板id=&quot; + freightModelPo.getId()));</span>
            }
            //未实现级联删除与商品关联的
            //获得数据库中此运费模板的所有明细,删除之
<span class="nc" id="L224">            WeightFreightModelPoExample weightFreightModelPoExample=new WeightFreightModelPoExample();</span>
<span class="nc" id="L225">            WeightFreightModelPoExample.Criteria criteria=weightFreightModelPoExample.createCriteria();</span>
<span class="nc" id="L226">            criteria.andFreightModelIdEqualTo(id);</span>
<span class="nc" id="L227">            List&lt;WeightFreightModelPo&gt; weightFreightPos = weightFreightModelPoMapper.selectByExample(weightFreightModelPoExample);</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">            if (!weightFreightPos.isEmpty()){</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">                for (WeightFreightModelPo po : weightFreightPos) {</span>
<span class="nc" id="L230">                    weightFreightModelPoMapper.deleteByPrimaryKey(po.getId());</span>
<span class="nc" id="L231">                    }</span>
                }

            //删除运费模板
<span class="nc" id="L235">            int ret=freightModelPoMapper.deleteByPrimaryKey(id);</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">            if(ret==0)</span>
            {
<span class="nc" id="L238">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误&quot;));</span>
            }
            else {
<span class="nc" id="L241">                return new ReturnObject&lt;&gt;();</span>
            }
<span class="nc" id="L243">        }catch (DataAccessException e){</span>
<span class="nc" id="L244">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误:删除失败&quot;));</span>
<span class="nc" id="L245">        }catch (Exception e){</span>
<span class="nc" id="L246">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;发生了未知错误：%s&quot;, e.getMessage()));</span>
        }
    }
    /*
     * 管理员克隆店铺的运费模板
     * @author 史韬韬
     * @parameter shopId 店铺id
     * @parameter id 运费模板id
     */
    public ReturnObject&lt;FreightModelRetVo&gt; cloneFreightModel(Long shopId, Long id){

        try{
<span class="nc" id="L258">            FreightModelPo freightModelPo=freightModelPoMapper.selectByPrimaryKey(id);</span>
<span class="nc" id="L259">            FreightModelBo freightModelBo=new FreightModelBo(freightModelPo);</span>
<span class="nc" id="L260">            FreightModelPo freightModelPo1=freightModelBo.createClonePo(shopId);</span>
<span class="nc" id="L261">            freightModelPoMapper.insertSelective(freightModelPo1);</span>
<span class="nc" id="L262">            Long freightModelId=freightModelPo1.getId();</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">            if(freightModelPo.getType().equals((byte) 0)){</span>
<span class="nc" id="L264">                WeightFreightModelPoExample weightFreightModelPoExample= new WeightFreightModelPoExample();</span>
<span class="nc" id="L265">                WeightFreightModelPoExample.Criteria criteria=weightFreightModelPoExample.createCriteria();</span>
<span class="nc" id="L266">                criteria.andFreightModelIdEqualTo(id);</span>
<span class="nc" id="L267">                List&lt;WeightFreightModelPo&gt; weightFreightModelPoList=weightFreightModelPoMapper.selectByExample(weightFreightModelPoExample);</span>
<span class="nc" id="L268">                WeightFreightModelPo weightFreightModelPo=weightFreightModelPoList.get(0);</span>
<span class="nc" id="L269">                WeightFreightModelBo weightFreightModelBo=new WeightFreightModelBo(weightFreightModelPo);</span>
<span class="nc" id="L270">                WeightFreightModelPo weightFreightModelPo1=weightFreightModelBo.createClonePo(shopId);</span>
<span class="nc" id="L271">                weightFreightModelPo1.setFreightModelId(freightModelId);</span>
<span class="nc" id="L272">                weightFreightModelPoMapper.insertSelective(weightFreightModelPo1);</span>
<span class="nc" id="L273">            }</span>
            else{
<span class="nc" id="L275">                PieceFreightModelPoExample pieceFreightModelPoExample= new PieceFreightModelPoExample();</span>
<span class="nc" id="L276">                PieceFreightModelPoExample.Criteria criteria=pieceFreightModelPoExample.createCriteria();</span>
<span class="nc" id="L277">                criteria.andFreightModelIdEqualTo(id);</span>
<span class="nc" id="L278">                List&lt;PieceFreightModelPo&gt; pieceFreightModelPoList=pieceFreightModelPoMapper.selectByExample(pieceFreightModelPoExample);</span>
<span class="nc" id="L279">                PieceFreightModelPo pieceFreightModelPo=pieceFreightModelPoList.get(0);</span>
<span class="nc" id="L280">                PieceFreightModelBo pieceFreightModelBo=new PieceFreightModelBo(pieceFreightModelPo);</span>
<span class="nc" id="L281">                PieceFreightModelPo pieceFreightModelPo1= pieceFreightModelBo.createClonePo();</span>
<span class="nc" id="L282">                pieceFreightModelPo1.setFreightModelId(freightModelId);</span>
<span class="nc" id="L283">                pieceFreightModelPoMapper.insertSelective(pieceFreightModelPo1);</span>
            }
<span class="nc" id="L285">            FreightModelBo freightModelBo1=new FreightModelBo(freightModelPo1);</span>
<span class="nc" id="L286">            FreightModelRetVo freightModelRetVo=new FreightModelRetVo(freightModelBo1);</span>
<span class="nc" id="L287">            return new ReturnObject&lt;FreightModelRetVo&gt;(freightModelRetVo);</span>
<span class="nc" id="L288">        }catch (DataAccessException e){</span>
<span class="nc" id="L289">            return  new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误：&quot;+ e.getMessage()));</span>
        }

    }

    /*
     * 获得运费模板概要
     * @author 史韬韬
     * @parameter id 运费模板id
     */
    public ReturnObject&lt;FreightModelSimpleInfoRetVo&gt; getFreightModelSimpleInfo(Long id){
        try {
<span class="nc" id="L301">            FreightModelPo freightModelPo=freightModelPoMapper.selectByPrimaryKey(id);</span>
<span class="nc" id="L302">            FreightModelSimpleInfoBo freightModelSimpleInfoBo=new FreightModelSimpleInfoBo(freightModelPo);</span>
<span class="nc" id="L303">            FreightModelSimpleInfoRetVo freightModelSimpleInfoRetVo=freightModelSimpleInfoBo.createfreightModelSimpleInfoRetVo();</span>
<span class="nc" id="L304">            return new ReturnObject&lt;&gt;(freightModelSimpleInfoRetVo);</span>
        }
<span class="nc" id="L306">        catch (DataAccessException e){</span>
<span class="nc" id="L307">            return  new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误：&quot;+ e.getMessage()));</span>
        }
    }

    /*
     * 管理员修改店铺运费模板
     * @author 史韬韬
     * created in 2020/12/7
     */
    public ReturnObject&lt;VoObject&gt; chanegFreightModel(Long id, Long shopId, FreightModelInfoVo freightModelInfoVo){
        try {
<span class="nc" id="L318">            FreightModelPo freightModelPo=freightModelPoMapper.selectByPrimaryKey(id);</span>
<span class="nc" id="L319">            freightModelPo.setName(freightModelInfoVo.getName());</span>
<span class="nc" id="L320">            freightModelPo.setUnit(freightModelInfoVo.getUnit());</span>
<span class="nc" id="L321">            freightModelPo.setShopId(shopId);</span>
<span class="nc" id="L322">            freightModelPoMapper.updateByPrimaryKeySelective(freightModelPo);</span>
<span class="nc" id="L323">            return new ReturnObject&lt;VoObject&gt;();</span>
        }
<span class="nc" id="L325">        catch (DataAccessException e){</span>
<span class="nc" id="L326">            return  new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误：&quot;+ e.getMessage()));</span>
        }

    }
    /*
     * 管理员定义件数模板明细
     * @author 陈星如
     * @date 2020/12/9 9:13
     */

    public ReturnObject&lt;Object&gt; postPieceItems(PieceModelInfoVo vo, Long shopId, Long id){

<span class="nc" id="L338">        ReturnObject&lt;Object&gt; retObj = null;</span>
        try {
<span class="nc" id="L340">            PieceModelInfoBo pieceModelInfoBo=vo.createPieceModelInfoBo();</span>
<span class="nc" id="L341">            pieceModelInfoBo.setId(id);</span>
<span class="nc" id="L342">            pieceModelInfoBo.setGmtCreate(LocalDateTime.now());</span>
<span class="nc" id="L343">            pieceModelInfoBo.setGmtModified(LocalDateTime.now());</span>

            //获得运费模板
<span class="nc" id="L346">            FreightModelPo freightModelPo=freightModelPoMapper.selectByPrimaryKey(id);</span>
            //运费模板不存在
<span class="nc bnc" id="L348" title="All 2 branches missed.">            if(freightModelPo==null){</span>
<span class="nc" id="L349">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;运费模板不存在&quot;));</span>
            }
            //运费模板不是本店铺的
<span class="nc bnc" id="L352" title="All 2 branches missed.">            if(!freightModelPo.getShopId().equals(shopId)){</span>
<span class="nc" id="L353">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_OUTSCOPE, String.format(&quot;运费模板不是本店铺的对象：运费模板id=&quot; + freightModelPo.getId()));</span>
            }
            //运费模板模式不是件数运费模板
<span class="nc bnc" id="L356" title="All 2 branches missed.">            if(freightModelPo.getType()!=(byte)1){</span>
<span class="nc" id="L357">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;运费模板模式不是件数运费模板&quot;));</span>
            }
            //获得数据库中此运费模板的所有明细
<span class="nc" id="L360">            PieceFreightModelPoExample pieceFreightModelPoExample=new PieceFreightModelPoExample();</span>
<span class="nc" id="L361">            PieceFreightModelPoExample.Criteria criteria=pieceFreightModelPoExample.createCriteria();</span>
<span class="nc" id="L362">            criteria.andFreightModelIdEqualTo(id);</span>
<span class="nc" id="L363">            List&lt;PieceFreightModelPo&gt; pieceFreightPos = pieceFreightModelPoMapper.selectByExample(pieceFreightModelPoExample);</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">            if (!pieceFreightPos.isEmpty()) {</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">                for (PieceFreightModelPo po : pieceFreightPos) {</span>
                    //如果找到一样的地区定义，则返回错误
<span class="nc bnc" id="L367" title="All 2 branches missed.">                    if (po.getRegionId().equals(pieceModelInfoBo.getRegionId())) {</span>
<span class="nc" id="L368">                        return new ReturnObject&lt;&gt;(ResponseCode.REGION_SAME, String.format(&quot;运费模板中该地区已定义&quot;));</span>
                    }
<span class="nc" id="L370">                }</span>
            }
            //表中插入明细数据
<span class="nc" id="L373">            PieceFreightModelPo pieceFreightModelPo=pieceModelInfoBo.getpieceFreightModelPo();</span>
<span class="nc" id="L374">            int retpieceFreightModel = pieceFreightModelPoMapper.insertSelective(pieceFreightModelPo);</span>
<span class="nc" id="L375">            PieceModelInfoRetVo pieceModelInfoRetVo=new PieceModelInfoRetVo(pieceModelInfoBo);</span>
<span class="nc" id="L376">            pieceModelInfoRetVo.setId(pieceFreightModelPo.getId());</span>
            //更新运费模板时间
<span class="nc" id="L378">            freightModelPo.setGmtModified(LocalDateTime.now());</span>
<span class="nc" id="L379">            freightModelPoMapper.updateByPrimaryKey(freightModelPo);</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">            if (retpieceFreightModel == 0) {</span>
<span class="nc" id="L381">                retObj = new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;数据库错误：新增失败&quot;));</span>
            }
            else {
<span class="nc" id="L384">                retObj = new ReturnObject&lt;&gt;(pieceModelInfoRetVo);</span>
            }
<span class="nc" id="L386">        }catch (DataAccessException e){</span>
<span class="nc" id="L387">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误&quot;));</span>
<span class="nc" id="L388">        }catch (Exception e){</span>
<span class="nc" id="L389">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;发生了未知错误：%s&quot;, e.getMessage()));</span>
<span class="nc" id="L390">        }</span>
<span class="nc" id="L391">        return retObj;</span>
    }

    /*
     * 管理员修改件数模板明细(未校验regionId是否合法、未校验Vo中负数数据是否合法)
     * @author 王子扬
     * @date 2020/12/10 9:13
     */
    public ReturnObject&lt;Object&gt; putPieceItems(PieceModelInfoVo vo, Long shopId, Long id){
        try {
            //获得运费模板
<span class="nc" id="L402">            PieceFreightModelPo pieceFreightModelPo=pieceFreightModelPoMapper.selectByPrimaryKey(id);</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">            if(pieceFreightModelPo==null){</span>
<span class="nc" id="L404">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;件数运费模板不存在&quot;));</span>
            }

<span class="nc" id="L407">            FreightModelPo freightModelPo=freightModelPoMapper.selectByPrimaryKey(pieceFreightModelPo.getFreightModelId());</span>
<span class="nc bnc" id="L408" title="All 2 branches missed.">            if(freightModelPo==null){</span>
<span class="nc" id="L409">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;运费模板不存在&quot;));</span>
            }
<span class="nc bnc" id="L411" title="All 2 branches missed.">            if(!freightModelPo.getShopId().equals(shopId)){//运费模板不是本店铺的</span>
<span class="nc" id="L412">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_OUTSCOPE, String.format(&quot;运费模板不是本店铺的对象：运费模板id=&quot; + freightModelPo.getId()));</span>
            }
<span class="nc bnc" id="L414" title="All 2 branches missed.">            if(freightModelPo.getType()!=(byte)1){//运费模板模式不是件数运费模板</span>
<span class="nc" id="L415">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;运费模板模式不是件数运费模板&quot;));</span>
            }
<span class="nc" id="L417">            PieceModelInfoBo pieceModelInfoBo=vo.createPieceModelInfoBo();</span>
<span class="nc" id="L418">            pieceModelInfoBo.setId(id);</span>
<span class="nc" id="L419">            pieceModelInfoBo.setGmtCreate(pieceFreightModelPo.getGmtCreate());</span>
<span class="nc" id="L420">            pieceModelInfoBo.setGmtModified(LocalDateTime.now());</span>

            //校验重复地区
<span class="nc" id="L423">            PieceFreightModelPoExample pieceFreightModelPoExample=new PieceFreightModelPoExample();</span>
<span class="nc" id="L424">            PieceFreightModelPoExample.Criteria criteria=pieceFreightModelPoExample.createCriteria();</span>
<span class="nc" id="L425">            criteria.andFreightModelIdEqualTo(id);</span>
<span class="nc" id="L426">            List&lt;PieceFreightModelPo&gt; pieceFreightPos = pieceFreightModelPoMapper.selectByExample(pieceFreightModelPoExample);</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">            if (!pieceFreightPos.isEmpty()) {</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">                for (PieceFreightModelPo po : pieceFreightPos) {</span>
                    //如果找到一样的地区定义，则返回错误
<span class="nc bnc" id="L430" title="All 4 branches missed.">                    if (po.getRegionId()!=null &amp;&amp; po.getRegionId().equals(pieceModelInfoBo.getRegionId())) {</span>
<span class="nc" id="L431">                        return new ReturnObject&lt;&gt;(ResponseCode.REGION_SAME, String.format(&quot;运费模板中该地区已定义&quot;));</span>
                    }
<span class="nc bnc" id="L433" title="All 2 branches missed.">                    if(po.getRegionId()==null){</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">                        if(pieceModelInfoBo.getRegionId()==null){</span>
<span class="nc" id="L435">                            return new ReturnObject&lt;&gt;(ResponseCode.REGION_SAME, String.format(&quot;运费模板中该地区已定义&quot;));</span>
                        }
                    }
<span class="nc" id="L438">                }</span>
            }

<span class="nc" id="L441">            PieceFreightModelPo pieceFreightModelPoUpdate=pieceModelInfoBo.getpieceFreightModelPo();</span>
<span class="nc" id="L442">            pieceFreightModelPoUpdate.setFreightModelId(freightModelPo.getId());</span>
<span class="nc" id="L443">            int ret=pieceFreightModelPoMapper.updateByPrimaryKey(pieceFreightModelPoUpdate);</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">            if(ret == 0){</span>
<span class="nc" id="L445">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;数据库错误：修改失败&quot;));</span>
            }else{
<span class="nc" id="L447">                return new ReturnObject&lt;&gt;();</span>
            }
<span class="nc" id="L449">        }catch (DataAccessException e){</span>
<span class="nc" id="L450">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误&quot;));</span>
<span class="nc" id="L451">        }catch (Exception e){</span>
<span class="nc" id="L452">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;发生了未知错误：%s&quot;, e.getMessage()));</span>
        }
    }

    /*
     * 管理员修改重量模板明细(未校验regionId是否合法、未校验Vo中负数数据是否合法)
     * @author 王子扬
     * @date 2020/12/10 9:13
     */
    public ReturnObject&lt;Object&gt; putWeightItems(WeightModelInfoVo vo, Long shopId, Long id){
        try {
            //获得运费模板
<span class="nc" id="L464">            WeightFreightModelPo weightFreightModelPo=weightFreightModelPoMapper.selectByPrimaryKey(id);</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">            if(weightFreightModelPo==null){</span>
<span class="nc" id="L466">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;重量运费模板不存在&quot;));</span>
            }

<span class="nc" id="L469">            FreightModelPo freightModelPo=freightModelPoMapper.selectByPrimaryKey(weightFreightModelPo.getFreightModelId());</span>
<span class="nc bnc" id="L470" title="All 2 branches missed.">            if(freightModelPo==null){</span>
<span class="nc" id="L471">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;运费模板不存在&quot;));</span>
            }
<span class="nc bnc" id="L473" title="All 2 branches missed.">            if(!freightModelPo.getShopId().equals(shopId)){//运费模板不是本店铺的</span>
<span class="nc" id="L474">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_OUTSCOPE, String.format(&quot;运费模板不是本店铺的对象：运费模板id=&quot; + freightModelPo.getId()));</span>
            }
<span class="nc bnc" id="L476" title="All 2 branches missed.">            if(freightModelPo.getType()!=(byte)0){//运费模板模式不是重量运费模板</span>
<span class="nc" id="L477">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;运费模板模式不是重量运费模板&quot;));</span>
            }

<span class="nc" id="L480">            WeightModelInfoBo weightModelInfoBo = vo.createWeightModelInfoBo();</span>
<span class="nc" id="L481">            weightModelInfoBo.setId(id);</span>
<span class="nc" id="L482">            weightModelInfoBo.setGmtCreate(weightFreightModelPo.getGmtCreate());</span>
<span class="nc" id="L483">            weightModelInfoBo.setGmtModified(LocalDateTime.now());</span>

            //校验重复地区
<span class="nc" id="L486">            WeightFreightModelPoExample weightFreightModelPoExample=new WeightFreightModelPoExample();</span>
<span class="nc" id="L487">            WeightFreightModelPoExample.Criteria criteria=weightFreightModelPoExample.createCriteria();</span>
<span class="nc" id="L488">            criteria.andFreightModelIdEqualTo(id);</span>
<span class="nc" id="L489">            List&lt;WeightFreightModelPo&gt; weightFreightPos = weightFreightModelPoMapper.selectByExample(weightFreightModelPoExample);</span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">            if (!weightFreightPos.isEmpty()){</span>
<span class="nc bnc" id="L491" title="All 2 branches missed.">                for (WeightFreightModelPo po : weightFreightPos) {</span>
                    //如果找到一样的地区定义，则返回错误
<span class="nc bnc" id="L493" title="All 4 branches missed.">                    if (po.getRegionId()!=null &amp;&amp; po.getRegionId().equals(weightModelInfoBo.getRegionId())) {</span>
<span class="nc" id="L494">                        return new ReturnObject&lt;&gt;(ResponseCode.REGION_SAME, String.format(&quot;运费模板中该地区已定义&quot;));</span>
                    }
<span class="nc bnc" id="L496" title="All 2 branches missed.">                    if(po.getRegionId()==null){</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">                        if(weightModelInfoBo.getRegionId()==null){</span>
<span class="nc" id="L498">                            return new ReturnObject&lt;&gt;(ResponseCode.REGION_SAME, String.format(&quot;运费模板中该地区已定义&quot;));</span>
                        }
                    }
<span class="nc" id="L501">                }</span>
            }

<span class="nc" id="L504">            WeightFreightModelPo weightFreightModelPoUpdate = weightModelInfoBo.getweightFreightModelPo();</span>
<span class="nc" id="L505">            weightFreightModelPoUpdate.setFreightModelId(freightModelPo.getId());</span>
<span class="nc" id="L506">            weightFreightModelPoUpdate.setId(weightModelInfoBo.getId());</span>
<span class="nc" id="L507">            int ret=weightFreightModelPoMapper.updateByPrimaryKey(weightFreightModelPoUpdate);</span>
<span class="nc bnc" id="L508" title="All 2 branches missed.">            if(ret == 0){</span>
<span class="nc" id="L509">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;数据库错误：修改失败&quot;));</span>
            }else{
<span class="nc" id="L511">                return new ReturnObject&lt;&gt;();</span>
            }
<span class="nc" id="L513">        }catch (DataAccessException e){</span>
<span class="nc" id="L514">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误&quot;));</span>
<span class="nc" id="L515">        }catch (Exception e){</span>
<span class="nc" id="L516">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;发生了未知错误：%s&quot;, e.getMessage()));</span>
        }
    }

    /*
     * 管理员删除件数模板明细
     * @author 王子扬
     * @date 2020/12/10 9:13
     */
    public ReturnObject&lt;Object&gt; deletePieceItems(Long shopId, Long id){
        try {
            //获得运费模板
<span class="nc" id="L528">            PieceFreightModelPo pieceFreightModelPo=pieceFreightModelPoMapper.selectByPrimaryKey(id);</span>
<span class="nc bnc" id="L529" title="All 2 branches missed.">            if(pieceFreightModelPo==null){</span>
<span class="nc" id="L530">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;件数运费模板不存在&quot;));</span>
            }

<span class="nc" id="L533">            FreightModelPo freightModelPo=freightModelPoMapper.selectByPrimaryKey(pieceFreightModelPo.getFreightModelId());</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">            if(freightModelPo==null){</span>
<span class="nc" id="L535">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;运费模板不存在&quot;));</span>
            }
<span class="nc bnc" id="L537" title="All 2 branches missed.">            if(!freightModelPo.getShopId().equals(shopId)){//运费模板不是本店铺的</span>
<span class="nc" id="L538">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_OUTSCOPE, String.format(&quot;运费模板不是本店铺的对象：运费模板id=&quot; + freightModelPo.getId()));</span>
            }
<span class="nc bnc" id="L540" title="All 2 branches missed.">            if(freightModelPo.getType()!=(byte)1){//运费模板模式不是件数运费模板</span>
<span class="nc" id="L541">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;运费模板模式不是件数运费模板&quot;));</span>
            }

<span class="nc" id="L544">            int ret=pieceFreightModelPoMapper.deleteByPrimaryKey(id);</span>
<span class="nc bnc" id="L545" title="All 2 branches missed.">            if(ret == 0){</span>
<span class="nc" id="L546">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;数据库错误：删除失败&quot;));</span>
            }else{
<span class="nc" id="L548">                return new ReturnObject&lt;&gt;();</span>
            }
<span class="nc" id="L550">        }catch (DataAccessException e){</span>
<span class="nc" id="L551">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误&quot;));</span>
<span class="nc" id="L552">        }catch (Exception e){</span>
<span class="nc" id="L553">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;发生了未知错误：%s&quot;, e.getMessage()));</span>
        }
    }

    /*
     * 管理员删除重量模板明细
     * @author 王子扬
     * @date 2020/12/10 9:13
     */
    public ReturnObject&lt;Object&gt; deleteWeightItems(Long shopId, Long id){
        try {
            //获得运费模板
<span class="nc" id="L565">            WeightFreightModelPo weightFreightModelPo=weightFreightModelPoMapper.selectByPrimaryKey(id);</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">            if(weightFreightModelPo==null){</span>
<span class="nc" id="L567">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;重量运费模板不存在&quot;));</span>
            }

<span class="nc" id="L570">            FreightModelPo freightModelPo=freightModelPoMapper.selectByPrimaryKey(weightFreightModelPo.getFreightModelId());</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">            if(freightModelPo==null){</span>
<span class="nc" id="L572">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;运费模板不存在&quot;));</span>
            }
<span class="nc bnc" id="L574" title="All 2 branches missed.">            if(!freightModelPo.getShopId().equals(shopId)){//运费模板不是本店铺的</span>
<span class="nc" id="L575">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_OUTSCOPE, String.format(&quot;运费模板不是本店铺的对象：运费模板id=&quot; + freightModelPo.getId()));</span>
            }
<span class="nc bnc" id="L577" title="All 2 branches missed.">            if(freightModelPo.getType()!=(byte)0){//运费模板模式不是重量运费模板</span>
<span class="nc" id="L578">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;运费模板模式不是重量运费模板&quot;));</span>
            }

<span class="nc" id="L581">            int ret=weightFreightModelPoMapper.deleteByPrimaryKey(id);</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">            if(ret == 0){</span>
<span class="nc" id="L583">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;数据库错误：删除失败&quot;));</span>
            }else{
<span class="nc" id="L585">                return new ReturnObject&lt;&gt;();</span>
            }
<span class="nc" id="L587">        }catch (DataAccessException e){</span>
<span class="nc" id="L588">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR,String.format(&quot;数据库错误&quot;));</span>
<span class="nc" id="L589">        }catch (Exception e){</span>
<span class="nc" id="L590">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;发生了未知错误：%s&quot;, e.getMessage()));</span>
        }
    }

    /*
     * 店家或管理员查询重量运费模板明细
     * @author 陈星如
     * @date 2020/12/8 13:33
     */
    public ReturnObject getFreightModelsWeightItems(Long shopId, Long id) {
<span class="nc" id="L600">        ReturnObject&lt;Object&gt; retObj = null;</span>
        try {
            //获得运费模板
<span class="nc" id="L603">            FreightModelPo freightModelPo = freightModelPoMapper.selectByPrimaryKey(id);</span>
            //运费模板不存在
<span class="nc bnc" id="L605" title="All 2 branches missed.">            if (freightModelPo == null) {</span>
<span class="nc" id="L606">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;运费模板不存在&quot;));</span>
            }
            //运费模板不是本店铺的
<span class="nc bnc" id="L609" title="All 2 branches missed.">            if (freightModelPo.getShopId().equals(shopId)) {</span>
<span class="nc" id="L610">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_OUTSCOPE, String.format(&quot;运费模板不是本店铺的对象：运费模板id=&quot; + freightModelPo.getId()));</span>
            }
            //运费模板模式不是重量运费模板
<span class="nc bnc" id="L613" title="All 2 branches missed.">            if (freightModelPo.getType() != (byte) 0) {</span>
<span class="nc" id="L614">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;运费模板模式不是重量运费模板&quot;));</span>
            }
            //获得数据库中此运费模板的所有明细
<span class="nc" id="L617">            WeightFreightModelPoExample weightFreightModelPoExample = new WeightFreightModelPoExample();</span>
<span class="nc" id="L618">            WeightFreightModelPoExample.Criteria criteria = weightFreightModelPoExample.createCriteria();</span>
<span class="nc" id="L619">            criteria.andFreightModelIdEqualTo(id);</span>

<span class="nc" id="L621">            List&lt;WeightFreightModelPo&gt; weightFreightPos = weightFreightModelPoMapper.selectByExample(weightFreightModelPoExample);</span>
<span class="nc" id="L622">            List&lt;WeightModelInfoRetVo&gt; ret = new ArrayList&lt;&gt;(weightFreightPos.size());</span>
<span class="nc bnc" id="L623" title="All 2 branches missed.">            if (!weightFreightPos.isEmpty()) {</span>
<span class="nc bnc" id="L624" title="All 2 branches missed.">                for (WeightFreightModelPo po : weightFreightPos) {</span>
<span class="nc" id="L625">                    WeightModelInfoRetVo weightFreightModelVo = new WeightModelInfoRetVo(po);</span>
<span class="nc" id="L626">                    ret.add(weightFreightModelVo);</span>
<span class="nc" id="L627">                }</span>
            }
            //返回运费模板明细列表
<span class="nc" id="L630">            return new ReturnObject&lt;&gt;(ret);</span>
<span class="nc" id="L631">        } catch (DataAccessException e) {</span>
<span class="nc" id="L632">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;数据库错误&quot;));</span>
<span class="nc" id="L633">        } catch (Exception e) {</span>
<span class="nc" id="L634">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;发生了未知错误：%s&quot;, e.getMessage()));</span>
        }
    }
    /**
     * 店家或管理员查询件数运费模板的明细
     * @author 陈星如
     * @date 2020/12/8 14:13
     **/
    public ReturnObject getFreightModelsPieceItems(Long shopId, Long id) {
<span class="nc" id="L643">        ReturnObject&lt;Object&gt; retObj = null;</span>
        try {
            //获得运费模板
<span class="nc" id="L646">            FreightModelPo freightModelPo = freightModelPoMapper.selectByPrimaryKey(id);</span>
            //运费模板不存在
<span class="nc bnc" id="L648" title="All 2 branches missed.">            if (freightModelPo == null) {</span>
<span class="nc" id="L649">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_NOTEXIST, String.format(&quot;运费模板不存在&quot;));</span>
            }
            //运费模板不是本店铺的
<span class="nc bnc" id="L652" title="All 2 branches missed.">            if (!freightModelPo.getShopId().equals(shopId)) {</span>
<span class="nc" id="L653">                return new ReturnObject&lt;&gt;(ResponseCode.RESOURCE_ID_OUTSCOPE, String.format(&quot;运费模板不是本店铺的对象：运费模板id=&quot; + freightModelPo.getId()));</span>
            }
            //运费模板模式不是件数运费模板
<span class="nc bnc" id="L656" title="All 2 branches missed.">            if (freightModelPo.getType() != (byte) 1) {</span>
<span class="nc" id="L657">                return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;运费模板模式不是件数运费模板&quot;));</span>
            }
            //获得数据库中此运费模板的所有明细
<span class="nc" id="L660">            PieceFreightModelPoExample pieceFreightModelPoExample = new PieceFreightModelPoExample();</span>
<span class="nc" id="L661">            PieceFreightModelPoExample.Criteria criteria = pieceFreightModelPoExample.createCriteria();</span>
<span class="nc" id="L662">            criteria.andFreightModelIdEqualTo(id);</span>
<span class="nc" id="L663">            List&lt;PieceFreightModelPo&gt; pieceFreightPos = pieceFreightModelPoMapper.selectByExample(pieceFreightModelPoExample);</span>
<span class="nc" id="L664">            List&lt;PieceModelInfoRetVo&gt; ret = new ArrayList&lt;&gt;(pieceFreightPos.size());</span>
<span class="nc bnc" id="L665" title="All 2 branches missed.">            if (!pieceFreightPos.isEmpty()) {</span>
<span class="nc bnc" id="L666" title="All 2 branches missed.">                for (PieceFreightModelPo po : pieceFreightPos) {</span>
<span class="nc" id="L667">                    PieceModelInfoRetVo pieceModelInfoRetVo = new PieceModelInfoRetVo(po);</span>
<span class="nc" id="L668">                    ret.add(pieceModelInfoRetVo);</span>

<span class="nc" id="L670">                }</span>
            }
            //返回运费模板明细列表
<span class="nc" id="L673">            return new ReturnObject&lt;&gt;(ret);</span>

<span class="nc" id="L675">        } catch (DataAccessException e) {</span>
<span class="nc" id="L676">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;数据库错误&quot;));</span>
<span class="nc" id="L677">        } catch (Exception e) {</span>
<span class="nc" id="L678">            return new ReturnObject&lt;&gt;(ResponseCode.INTERNAL_SERVER_ERR, String.format(&quot;发生了未知错误：%s&quot;, e.getMessage()));</span>
        }
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>